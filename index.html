<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ARACEA â€“ LoterÃ­a Solidaria</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
header{background:#ff7a00;padding:15px;text-align:center;font-size:18px;font-weight:bold}
.logo{font-size:22px}
.container{padding:15px}
button{width:100%;padding:12px;margin:6px 0;border:none;border-radius:10px;background:#ff7a00;color:#000;font-weight:bold;font-size:16px}
.card{background:#1c1c1c;padding:12px;border-radius:10px;margin-bottom:8px}
input,select{width:100%;padding:10px;margin:5px 0;border-radius:8px;border:none}
.hidden{display:none}
.small{color:#aaa;font-size:13px}
.total{background:#222;padding:12px;border-radius:10px;margin-top:10px}
</style>
</head>
<body>

<header>
<div class="logo">ğŸ¾ ARACEA â€“ LoterÃ­a Solidaria</div>
</header>

<div class="container">

<!-- INICIO -->
<div id="homeView">
<h3>Selecciona campaÃ±a</h3>
<button onclick="openCampaign('Navidad')">ğŸ„ Navidad</button>
<button onclick="openCampaign('NiÃ±o')">ğŸ‘¶ NiÃ±o</button>
<button onclick="openCampaign('Semanal')">ğŸ“… Semanal</button>
<button onclick="openCampaign('Mensual')">ğŸ“† Mensual</button>
<button onclick="showGlobalHistory()">ğŸ“Š Historial Global</button>
</div>

<!-- AÃ‘OS -->
<div id="yearView" class="hidden">
<h3 id="campTitle"></h3>
<select id="yearSelect"></select>
<button onclick="enterYear()">Entrar</button>
<button onclick="backHome()">â¬… Volver</button>
</div>

<!-- GESTIÃ“N -->
<div id="manageView" class="hidden">
<h3 id="manageTitle"></h3>

<h4>AÃ±adir nÃºmero</h4>
<input id="num" placeholder="NÃºmero (5 cifras)" maxlength="5">
<input type="number" id="decimos" placeholder="NÂº de dÃ©cimos">
<input type="number" id="precio" placeholder="Precio por dÃ©cimo (â‚¬)">
<input type="number" id="vendidos" placeholder="Vendidos">
<button onclick="addNumber()">Guardar nÃºmero</button>

<div id="listNumbers"></div>

<div class="total" id="totals"></div>

<button onclick="closeYear()">Cerrar campaÃ±a</button>
<button onclick="backYears()">â¬… Cambiar aÃ±o</button>
</div>

<!-- HISTORIAL -->
<div id="historyView" class="hidden">
<h3>Historial Global</h3>
<div id="historyList"></div>
<button onclick="backHome()">â¬… Volver</button>
</div>

</div>

<script>
let data=JSON.parse(localStorage.getItem("araceaFinal"))||{campaigns:{}};
let currentCamp="",currentYear="";

function save(){localStorage.setItem("araceaFinal",JSON.stringify(data));}

function openCampaign(c){
 currentCamp=c;
 document.getElementById("homeView").classList.add("hidden");
 document.getElementById("yearView").classList.remove("hidden");
 document.getElementById("campTitle").innerText="CampaÃ±a "+c;
 loadYears();
}

function loadYears(){
 let sel=document.getElementById("yearSelect");
 sel.innerHTML="";
 let y=new Date().getFullYear();
 for(let i=y-1;i<=y+3;i++){
  let o=document.createElement("option");
  o.value=i;o.text=i;
  sel.appendChild(o);
 }
}

function enterYear(){
 currentYear=document.getElementById("yearSelect").value;
 if(!data.campaigns[currentCamp]) data.campaigns[currentCamp]={};
 if(!data.campaigns[currentCamp][currentYear]){
  data.campaigns[currentCamp][currentYear]={numbers:[],closed:false};
 }
 showManage();
}

function showManage(){
 document.getElementById("yearView").classList.add("hidden");
 document.getElementById("manageView").classList.remove("hidden");
 document.getElementById("manageTitle").innerText=currentCamp+" "+currentYear;
 renderNumbers();
}

function addNumber(){
 let n=document.getElementById("num").value;
 let d=parseInt(document.getElementById("decimos").value);
 let p=parseFloat(document.getElementById("precio").value);
 let v=parseInt(document.getElementById("vendidos").value);
 if(n.length!=5||isNaN(d)||isNaN(p)||isNaN(v)) return alert("Revisa los datos");
 data.campaigns[currentCamp][currentYear].numbers.push({n,d,p,v});
 save();
 document.getElementById("num").value="";
 document.getElementById("decimos").value="";
 document.getElementById("precio").value="";
 document.getElementById("vendidos").value="";
 renderNumbers();
}

function renderNumbers(){
 let list=document.getElementById("listNumbers");
 list.innerHTML="";
 let totalRec=0,totalVend=0,benef=0;
 let nums=data.campaigns[currentCamp][currentYear].numbers;
 nums.forEach((x,i)=>{
  totalRec+=x.v*x.p;
  totalVend+=x.v;
  benef+=x.v*3;
  list.innerHTML+=`
   <div class="card">
   NÂº ${x.n} | DÃ©cimos: ${x.d} | Vendidos: ${x.v}<br>
   ${x.p}â‚¬ por dÃ©cimo
   <button onclick="delNumber(${i})">âŒ</button>
   </div>`;
 });
 document.getElementById("totals").innerHTML=`
 ğŸ’° Total recaudado: ${totalRec} â‚¬<br>
 ğŸŸï¸ Vendidos: ${totalVend}<br>
 ğŸ¾ Beneficio ARACEA: ${benef} â‚¬
 `;
}

function delNumber(i){
 data.campaigns[currentCamp][currentYear].numbers.splice(i,1);
 save();
 renderNumbers();
}

function closeYear(){
 data.campaigns[currentCamp][currentYear].closed=true;
 save();
 alert("CampaÃ±a cerrada");
}

function backYears(){
 document.getElementById("manageView").classList.add("hidden");
 document.getElementById("yearView").classList.remove("hidden");
}

function backHome(){
 document.getElementById("yearView").classList.add("hidden");
 document.getElementById("manageView").classList.add("hidden");
 document.getElementById("historyView").classList.add("hidden");
 document.getElementById("homeView").classList.remove("hidden");
}

function showGlobalHistory(){
 document.getElementById("homeView").classList.add("hidden");
 document.getElementById("historyView").classList.remove("hidden");
 let h=document.getElementById("historyList");
 h.innerHTML="";
 Object.keys(data.campaigns).forEach(c=>{
  Object.keys(data.campaigns[c]).forEach(y=>{
   let sum=0;
   data.campaigns[c][y].numbers.forEach(x=>sum+=x.v*x.p);
   h.innerHTML+=`<div class="card">${c} ${y} â†’ ${sum} â‚¬</div>`;
  });
 });
}
</script>
</body>
</html>
