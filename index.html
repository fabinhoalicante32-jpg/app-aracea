<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ARACEA â€“ GestiÃ³n de LoterÃ­a</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
header{background:#ff7a00;padding:15px;text-align:center;font-weight:bold}
.container{padding:15px}
.card{background:#1e1e1e;padding:12px;margin-bottom:10px;border-radius:8px}
button{width:100%;padding:12px;margin:5px 0;background:#ff7a00;color:#000;border:none;border-radius:6px;font-weight:bold}
input,select{width:100%;padding:10px;margin:5px 0;border-radius:6px;border:none}
.hidden{display:none}
.small{font-size:13px;color:#ccc}
</style>
</head>
<body>

<header>ARACEA â€“ AsociaciÃ³n de Rescate Animal</header>
<div class="container">

<!-- VISTA TIPOS -->
<div id="typesView">
<h2>Tipos de LoterÃ­a</h2>
<button onclick="openYears('Navidad')">Navidad</button>
<button onclick="openYears('NiÃ±o')">NiÃ±o</button>
<button onclick="openYears('Semanal')">Semanal</button>
<button onclick="openYears('Mensual')">Mensual</button>
<button onclick="showHistory()">ðŸ“Š Historial Global</button>
</div>

<!-- VISTA AÃ‘OS -->
<div id="yearsView" class="hidden">
<h2 id="typeTitle"></h2>
<input type="number" id="newYear" placeholder="Ej: 2026">
<button onclick="addYear()">âž• AÃ±adir AÃ±o</button>
<div id="yearsList"></div>
<button onclick="backTypes()">â¬… Volver</button>
</div>

<!-- VISTA CAMPAÃ‘A -->
<div id="campaignView" class="hidden">
<h2 id="campaignTitle"></h2>
<input id="numDecimos" placeholder="NÃºmero de dÃ©cimos">
<input type="number" id="cantidad" placeholder="Cantidad">
<input type="number" id="precio" placeholder="Precio por dÃ©cimo">
<button onclick="addEntry()">Registrar Movimiento</button>
<button onclick="closeCampaign()">Cerrar CampaÃ±a</button>
<div id="entriesList"></div>
<button onclick="backYears()">â¬… Volver</button>
</div>

<!-- HISTORIAL -->
<div id="historyView" class="hidden">
<h2>Historial Global</h2>
<div id="historyList"></div>
<button onclick="backTypes()">â¬… Volver</button>
</div>

</div>

<script>
let data = JSON.parse(localStorage.getItem("araceaData")) || {types:{}};
let currentType="",currentYear="";

function save(){localStorage.setItem("araceaData",JSON.stringify(data));}

function openYears(type){
 currentType=type;
 if(!data.types[type]) data.types[type]={years:{}};
 document.getElementById("typesView").classList.add("hidden");
 document.getElementById("yearsView").classList.remove("hidden");
 document.getElementById("typeTitle").innerText="AÃ±os â€“ "+type;
 loadYears();
}

function backTypes(){
 document.getElementById("typesView").classList.remove("hidden");
 document.getElementById("yearsView").classList.add("hidden");
 document.getElementById("campaignView").classList.add("hidden");
 document.getElementById("historyView").classList.add("hidden");
}

function loadYears(){
 let div=document.getElementById("yearsList");
 div.innerHTML="";
 Object.keys(data.types[currentType].years).forEach(y=>{
  div.innerHTML+=`<button onclick="openCampaign('${y}')">${y}</button>`;
 });
}

function addYear(){
 let y=document.getElementById("newYear").value;
 if(!y)return;
 data.types[currentType].years[y]={entries:[],closed:false};
 save();
 loadYears();
 document.getElementById("newYear").value="";
}

function openCampaign(year){
 currentYear=year;
 document.getElementById("yearsView").classList.add("hidden");
 document.getElementById("campaignView").classList.remove("hidden");
 document.getElementById("campaignTitle").innerText=currentType+" "+year;
 showEntries();
}

function backYears(){
 document.getElementById("campaignView").classList.add("hidden");
 document.getElementById("yearsView").classList.remove("hidden");
}

function addEntry(){
 let n=document.getElementById("numDecimos").value;
 let c=parseInt(document.getElementById("cantidad").value);
 let p=parseFloat(document.getElementById("precio").value);
 if(!n||!c||!p)return alert("Faltan datos");
 data.types[currentType].years[currentYear].entries.push({n,c,p});
 save();
 showEntries();
 document.getElementById("numDecimos").value="";
 document.getElementById("cantidad").value="";
 document.getElementById("precio").value="";
}

function showEntries(){
 let list=document.getElementById("entriesList");
 list.innerHTML="";
 let total=0;
 data.types[currentType].years[currentYear].entries.forEach(e=>{
  total+=e.c*e.p;
  list.innerHTML+=`<div class="card">${e.n} | ${e.c} dÃ©cimos | ${e.p}â‚¬</div>`;
 });
 list.innerHTML+=`<div class="card"><b>Total: ${total}â‚¬</b></div>`;
}

function closeCampaign(){
 data.types[currentType].years[currentYear].closed=true;
 save();
 alert("CampaÃ±a cerrada y guardada en historial");
}

function showHistory(){
 document.getElementById("typesView").classList.add("hidden");
 document.getElementById("historyView").classList.remove("hidden");
 let h=document.getElementById("historyList");
 h.innerHTML="";
 Object.keys(data.types).forEach(t=>{
  Object.keys(data.types[t].years).forEach(y=>{
   let total=0;
   data.types[t].years[y].entries.forEach(e=>total+=e.c*e.p);
   h.innerHTML+=`<div class="card">${t} ${y} â†’ ${total}â‚¬</div>`;
  });
 });
}
</script>
</body>
</html>
